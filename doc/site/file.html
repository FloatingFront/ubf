 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=iso-8859-1'>
<TITLE>Site</TITLE>
</HEAD>
<BODY TEXT='#222222' BGCOLOR='#DDDDDD'
TOPMARGIN='0' LEFTMARGIN='0' MARGINWIDTH='10'
MARGINHEIGHT='0'><p>&nbsp;
<table>
<tr>
<td valign='top' width='15%'>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%' >
<TR VALIGN=TOP BGCOLOR='#cc000000'>
<TD BGCOLOR='#DDDDDD'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
<TD><IMG SRC='../images/cl.png' ALT='' HEIGHT=10 WIDTH=7></TD>
<TD><B><FONT FACE='verdana,helvetica,arial'><FONT
COLOR='#FFFFFF'><FONT
SIZE=-1>Documents</FONT></FONT></FONT></B></TD>
<TD ALIGN=RIGHT><IMG SRC='../images/cr.png' ALT='' HEIGHT=10 WIDTH=7></TD>
<TD ALIGN=RIGHT BGCOLOR='#DDDDDD'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
</TR>
</TABLE>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%' >
<TR BGCOLOR='#cc000000'>
<TD COLSPAN='3'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD>
</TR>
<TR BGCOLOR='#FFFFFF'>
<TD BACKGROUND='../images/sl.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
<TD WIDTH='100%'>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=5 WIDTH='100%' >
<TR><TD>
<a href="home.html">Home</a>
<br><a href="white.html">White paper</a>
<br><a href="ubfa.html">UBF(A) spec</a>
<br><a href="ubfb.html">UBF(B) spec</a>
</TD></TR>
</TABLE>
</TD>
<TD ALIGN=RIGHT BACKGROUND='../images/sr.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
</TR>
<TR>
<TD COLSPAN='3' BGCOLOR='#cc000000'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD>
</TR>
</TABLE>
<p>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%' >
<TR VALIGN=TOP BGCOLOR='#cc000000'>
<TD BGCOLOR='#DDDDDD'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
<TD><IMG SRC='../images/cl.png' ALT='' HEIGHT=10 WIDTH=7></TD>
<TD><B><FONT FACE='verdana,helvetica,arial'><FONT
COLOR='#FFFFFF'><FONT
SIZE=-1>Tutorials</FONT></FONT></FONT></B></TD>
<TD ALIGN=RIGHT><IMG SRC='../images/cr.png' ALT='' HEIGHT=10 WIDTH=7></TD>
<TD ALIGN=RIGHT BGCOLOR='#DDDDDD'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
</TR>
</TABLE>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%' >
<TR BGCOLOR='#cc000000'>
<TD COLSPAN='3'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD>
</TR>
<TR BGCOLOR='#FFFFFF'>
<TD BACKGROUND='../images/sl.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
<TD WIDTH='100%'>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=5 WIDTH='100%' >
<TR><TD>
<a href="quick.html">Quick start</a>
<br><a href="eserve.html">Erlang servers</a>
<br><a href="javac.html">Java clients</a>
</TD></TR>
</TABLE>
</TD>
<TD ALIGN=RIGHT BACKGROUND='../images/sr.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
</TR>
<TR>
<TD COLSPAN='3' BGCOLOR='#cc000000'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD>
</TR>
</TABLE>
<p>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%' >
<TR VALIGN=TOP BGCOLOR='#cc000000'>
<TD BGCOLOR='#DDDDDD'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
<TD><IMG SRC='../images/cl.png' ALT='' HEIGHT=10 WIDTH=7></TD>
<TD><B><FONT FACE='verdana,helvetica,arial'><FONT
COLOR='#FFFFFF'><FONT
SIZE=-1>Services</FONT></FONT></FONT></B></TD>
<TD ALIGN=RIGHT><IMG SRC='../images/cr.png' ALT='' HEIGHT=10 WIDTH=7></TD>
<TD ALIGN=RIGHT BGCOLOR='#DDDDDD'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
</TR>
</TABLE>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%' >
<TR BGCOLOR='#cc000000'>
<TD COLSPAN='3'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD>
</TR>
<TR BGCOLOR='#FFFFFF'>
<TD BACKGROUND='../images/sl.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
<TD WIDTH='100%'>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=5 WIDTH='100%' >
<TR><TD>
<a href="irc.html">IRC</a>
<br><a href="messagebox.html">Message Box</a>
<br><a href="file.html">File server</a>
</TD></TR>
</TABLE>
</TD>
<TD ALIGN=RIGHT BACKGROUND='../images/sr.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
</TR>
<TR>
<TD COLSPAN='3' BGCOLOR='#cc000000'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD>
</TR>
</TABLE>
<p>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%' >
<TR VALIGN=TOP BGCOLOR='#cc000000'>
<TD BGCOLOR='#DDDDDD'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
<TD><IMG SRC='../images/cl.png' ALT='' HEIGHT=10 WIDTH=7></TD>
<TD><B><FONT FACE='verdana,helvetica,arial'><FONT
COLOR='#FFFFFF'><FONT
SIZE=-1>Downloads</FONT></FONT></FONT></B></TD>
<TD ALIGN=RIGHT><IMG SRC='../images/cr.png' ALT='' HEIGHT=10 WIDTH=7></TD>
<TD ALIGN=RIGHT BGCOLOR='#DDDDDD'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
</TR>
</TABLE>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%' >
<TR BGCOLOR='#cc000000'>
<TD COLSPAN='3'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD>
</TR>
<TR BGCOLOR='#FFFFFF'>
<TD BACKGROUND='../images/sl.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
<TD WIDTH='100%'>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=5 WIDTH='100%' >
<TR><TD>
<a href="downloads.html">Downloads</a>
</TD></TR>
</TABLE>
</TD>
<TD ALIGN=RIGHT BACKGROUND='../images/sr.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=3 WIDTH=3></TD>
</TR>
<TR>
<TD COLSPAN='3' BGCOLOR='#cc000000'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD>
</TR>
</TABLE>
<p>
<p>
</td>
<td valign='top'>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%'> <TR VALIGN=TOP><TD BGCOLOR='#cc0000'><IMG SRC='../images/cl.png' ALT='' HEIGHT=10 WIDTH=7><IMG SRC='../images/pix.gif' ALT='' HEIGHT=4 WIDTH=4></TD>
<TD WIDTH='100%' BGCOLOR='#cc0000'> <TABLE BORDER=0 CELLSPACING=0 CELLPADDING=2 WIDTH='100%' > <TR> <TD BGCOLOR='#cc0000'><B><FONT FACE='verdana,helvetica,arial'><FONT COLOR='#FFFFFF'><FONT SIZE='+0'>UBF(B)</FONT></FONT></FONT></B></TD></TR></TABLE></TD>
<TD ALIGN=RIGHT BGCOLOR='#cc0000'><IMG SRC='../images/cr.png' ALT='' HEIGHT=10 WIDTH=7></TD></TR></TABLE>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%' ><TR><TD BACKGROUND='../images/gl.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=11 WIDTH=11></TD>
<TD WIDTH='100%' BGCOLOR='#cc0000'><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=5 WIDTH='100%' ><TR><TD BGCOLOR='#E6E6E6'><FONT FACE='verdana,helvetica,arial'><FONT SIZE=-2>2002-03-05</FONT></FONT></TD></TR></TABLE></TD>
<TD BACKGROUND='../images/gr.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=11 WIDTH=11></TD></TR><TR><TD COLSPAN='3' BGCOLOR='#006666'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD></TR>
<TR><TD BACKGROUND='../images/wl.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=11 WIDTH=11></TD><TD WIDTH='100%' BGCOLOR='#FFFFFF'><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=5 WIDTH='100%' ><TR><TD BGCOLOR='#FFFFFF'>
<h3>File server</h3>
<h3>Description</h3>
<h3>The contract</h3>
<p><TABLE BORDER=2><tr><td><pre>+NAME("file_server").

+VSN("ubf1.0").

+INFO("I am a mini file server").

+DESCRIPTION("The mini file server 
allows only list, and get operations
").

+TYPE password() = string().
+TYPE file()     = string().

+STATE start 
	{logon, password()}  => ok    & active 
			      | error & stop.

+STATE active 
       ls                      => {files, [string()]} & active;
       {get, file()}           => binary()            & active
			        | noSuchFile          & stop.


</pre></td></tr></table> <h3>A telnet session</h3>
<p>A full telnet session using the server can be found in the
<a href="quick.html">quick start tutorial</a>
<h3>An Erlang client</h3>
<p><TABLE BORDER=2><tr><td><pre>-module(file_client).

-compile(export_all).

-import(lists, [map/2, foldl/3, filter/2]).
-import(client, [rpc/2]).

defaultPort() -> 2000.

s(X) -> {'#S', X}.

-define(S(X), {'#S',X}).

    
test() ->
    {ok, Pid, Name} = client:start(host(), defaultPort()),
    {reply, _, start} = rpc(Pid, {startService, s("file_server"), []}),
    {reply, ok, active} = rpc(Pid, {logon, s("jimmy")}),
    {reply,  {files, Fs}, active} = rpc(Pid, ls),
    Files = map(fun(?S(I)) -> I end, Fs),
    io:format("Files=~p~n",[Files]),
    {reply, X, active} = rpc(Pid, {get, s("ubf.erl")}),
    io:format("got ~p bytes~n",[size(X)]),
    client:stop(Pid),
    io:format("test worked~n"),
    ok.

host() -> 
    case os:getenv("WHERE") of
	"HOME" -> "localhost";
	"WORK" ->  "p2p.sics.se"
    end.
</pre></td></tr></table> <h3>The Erlang file server plugin</h3>
<p><TABLE BORDER=2><tr><td><pre>-module(file_plugin).

-export([manager_start/2, client_stop/3,
	 managerStartState/0, handlerStartState/0, 
	 manager_rpc/2, handle_rpc/4]).

-import(lists, [map/2, member/2]).

%% NOTE the following two lines

-compile({parse_transform,contract_parser}).
-add_contract("file_plugin").

-define(S(X), {'#S',X}).
s(X) -> {'#S', X}.

%% The initial state of the manager

managerStartState() -> myManagerState.

handlerStartState() -> myHandlerState.
    
%% manager_start(Args, State) is called every time a session is started
%% Args comes from client:start(Host,Port,Service,Args)
%% Service in the rcp:start must match name()
%% manager_start(Args, State) -> {accept, Reply, State} | {reject, Why, State}
%% State is the manager state.

manager_start(_, ManagerState) ->
    Reply = yesOffWeGo,
    HandlerState = start,
    HandlerData = myInitailData0,
    {accept, Reply, HandlerState, HandlerData, ManagerState}.

client_stop(Pid, Reason, State) ->
    io:format("Client stopped:~p ~p~n",[Pid, Reason]),
    State.

manager_rpc(secret, State) ->
    {accept, welcomeToFTP, State};
manager_rpc(_, State) ->
    {reject, badPassword, State}.

handle_rpc(start, {logon, ?S("jimmy")}, State, Env) ->
    {ok, active, State};
handle_rpc(active, ls, State, Env) ->
    {ok, Files} = file:list_dir("."),
    Ret = map(fun(I) -> s(I) end, Files),
    {{files, Ret}, active, State};
handle_rpc(active, {get, ?S(File)}, State, Env) ->
    {ok, Files} = file:list_dir("."),
    case member(File, Files) of
	true ->
	    {ok, Bin} = file:read_file(File),
	    {Bin, active, State};
	false ->
	    {noSuchFile, stop, State}
    end.




</pre></td></tr></table> </TD>
</TR></TABLE></TD><TD BACKGROUND='../images/wr.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=11 WIDTH=11></TD></TR>
<TR BGCOLOR='#cc0000'><TD COLSPAN='3'><IMG SRC='../images/pix.gif' HEIGHT=1 WIDTH=1 ALT=''></TD></TR></TABLE><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH='100%'>
<TR><TD BACKGROUND='../images/wl_cccccc.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=11 WIDTH=11></TD><TD WIDTH='100%' BGCOLOR='#FFFFFF'>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=5 WIDTH='100%' ><TR><TD BGCOLOR='#CCCCCC'><B><FONT FACE='verdana,helvetica,arial'><FONT SIZE=-1>(&nbsp;
<A HREF=''></A>
)</FONT></FONT></B></TD></TR></TABLE></TD><TD BACKGROUND='../images/wr_cccccc.png'><IMG SRC='../images/pix.gif' ALT='' HEIGHT=11 WIDTH=11></TD></TR>
<TR><TD COLSPAN='3' BGCOLOR='#cc0000'><IMG SRC='../images/pix.gif' HEIGHT=1
WIDTH=1 ALT=''></TD></TR></TABLE>
</td>
</tr>
</table>
</body>
</html>
